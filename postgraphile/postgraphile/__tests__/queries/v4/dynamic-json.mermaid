%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/v4/dynamic-json"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 9, 48, 56, 64, 72, 80, 88, 96, 117, 118, 119, 120, 121, 10, 11, 19, 27, 35, 43, 51, 59, 67, 75, 83, 91, 99<br />2: 7, 17, 25, 33, 41, 49, 57, 65, 73, 81, 89, 97, 106<br />ᐳ: 12, 20, 28, 36, 44, 52, 60, 68, 76, 84, 92, 100<br />3: 13, 21, 29, 37, 45, 53, 61, 69, 77, 85, 93, 101, 108<br />ᐳ: 14, 15, 22, 23, 30, 31, 38, 39, 46, 47, 54, 55, 62, 63, 70, 71, 78, 79, 86, 87, 94, 95, 102, 103<br />4: ConnectionItems[110]"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 108, 110<br /><br />ROOT Connectionᐸ106ᐳ[108]"):::bucket
    Bucket3("Bucket 3 (listItem)<br /><br />ROOT __Item{3}ᐸ110ᐳ[113]"):::bucket
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 114<br /><br />ROOT PgSelectSingle{3}ᐸtypesᐳ[114]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket3
    Bucket3 --> Bucket4

    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    PgFromExpression11{{"PgFromExpression[11∈0] ➊<br />More deps:<br />- Constantᐸtrueᐳ[117]"}}:::plan
    Object10 & PgFromExpression11 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    PgSelect17[["PgSelect[17∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression19{{"PgFromExpression[19∈0] ➊<br />More deps:<br />- Constantᐸfalseᐳ[118]"}}:::plan
    Object10 & PgFromExpression19 --> PgSelect17
    PgSelect25[["PgSelect[25∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression27{{"PgFromExpression[27∈0] ➊<br />More deps:<br />- Constantᐸ42ᐳ[119]"}}:::plan
    Object10 & PgFromExpression27 --> PgSelect25
    PgSelect33[["PgSelect[33∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression35{{"PgFromExpression[35∈0] ➊<br />More deps:<br />- Constantᐸ3.1415ᐳ[120]"}}:::plan
    Object10 & PgFromExpression35 --> PgSelect33
    PgSelect41[["PgSelect[41∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression43{{"PgFromExpression[43∈0] ➊<br />More deps:<br />- Constantᐸ'hello, world!'ᐳ[121]"}}:::plan
    Object10 & PgFromExpression43 --> PgSelect41
    PgSelect49[["PgSelect[49∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression51{{"PgFromExpression[51∈0] ➊"}}:::plan
    Object10 & PgFromExpression51 --> PgSelect49
    PgSelect57[["PgSelect[57∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression59{{"PgFromExpression[59∈0] ➊"}}:::plan
    Object10 & PgFromExpression59 --> PgSelect57
    PgSelect65[["PgSelect[65∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression67{{"PgFromExpression[67∈0] ➊"}}:::plan
    Object10 & PgFromExpression67 --> PgSelect65
    PgSelect73[["PgSelect[73∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression75{{"PgFromExpression[75∈0] ➊"}}:::plan
    Object10 & PgFromExpression75 --> PgSelect73
    PgSelect81[["PgSelect[81∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression83{{"PgFromExpression[83∈0] ➊"}}:::plan
    Object10 & PgFromExpression83 --> PgSelect81
    PgSelect89[["PgSelect[89∈0] ➊<br />ᐸjsonb_identityᐳ"]]:::plan
    PgFromExpression91{{"PgFromExpression[91∈0] ➊"}}:::plan
    Object10 & PgFromExpression91 --> PgSelect89
    PgSelect97[["PgSelect[97∈0] ➊<br />ᐸjsonb_identityᐳ"]]:::plan
    PgFromExpression99{{"PgFromExpression[99∈0] ➊"}}:::plan
    Object10 & PgFromExpression99 --> PgSelect97
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    Access12{{"Access[12∈0] ➊<br />ᐸ7.itemsᐳ"}}:::plan
    PgSelect7 --> Access12
    First13[["First[13∈0] ➊"]]:::plan
    Access12 --> First13
    PgSelectSingle14{{"PgSelectSingle[14∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First13 --> PgSelectSingle14
    Access20{{"Access[20∈0] ➊<br />ᐸ17.itemsᐳ"}}:::plan
    PgSelect17 --> Access20
    First21[["First[21∈0] ➊"]]:::plan
    Access20 --> First21
    PgSelectSingle22{{"PgSelectSingle[22∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First21 --> PgSelectSingle22
    Access28{{"Access[28∈0] ➊<br />ᐸ25.itemsᐳ"}}:::plan
    PgSelect25 --> Access28
    First29[["First[29∈0] ➊"]]:::plan
    Access28 --> First29
    PgSelectSingle30{{"PgSelectSingle[30∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First29 --> PgSelectSingle30
    Access36{{"Access[36∈0] ➊<br />ᐸ33.itemsᐳ"}}:::plan
    PgSelect33 --> Access36
    First37[["First[37∈0] ➊"]]:::plan
    Access36 --> First37
    PgSelectSingle38{{"PgSelectSingle[38∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First37 --> PgSelectSingle38
    Access44{{"Access[44∈0] ➊<br />ᐸ41.itemsᐳ"}}:::plan
    PgSelect41 --> Access44
    First45[["First[45∈0] ➊"]]:::plan
    Access44 --> First45
    PgSelectSingle46{{"PgSelectSingle[46∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First45 --> PgSelectSingle46
    __InputDynamicScalar48{{"__InputDynamicScalar[48∈0] ➊"}}:::plan
    __InputDynamicScalar48 --> PgFromExpression51
    Access52{{"Access[52∈0] ➊<br />ᐸ49.itemsᐳ"}}:::plan
    PgSelect49 --> Access52
    First53[["First[53∈0] ➊"]]:::plan
    Access52 --> First53
    PgSelectSingle54{{"PgSelectSingle[54∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First53 --> PgSelectSingle54
    __InputDynamicScalar56{{"__InputDynamicScalar[56∈0] ➊"}}:::plan
    __InputDynamicScalar56 --> PgFromExpression59
    Access60{{"Access[60∈0] ➊<br />ᐸ57.itemsᐳ"}}:::plan
    PgSelect57 --> Access60
    First61[["First[61∈0] ➊"]]:::plan
    Access60 --> First61
    PgSelectSingle62{{"PgSelectSingle[62∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First61 --> PgSelectSingle62
    __InputDynamicScalar64{{"__InputDynamicScalar[64∈0] ➊"}}:::plan
    __InputDynamicScalar64 --> PgFromExpression67
    Access68{{"Access[68∈0] ➊<br />ᐸ65.itemsᐳ"}}:::plan
    PgSelect65 --> Access68
    First69[["First[69∈0] ➊"]]:::plan
    Access68 --> First69
    PgSelectSingle70{{"PgSelectSingle[70∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First69 --> PgSelectSingle70
    __InputDynamicScalar72{{"__InputDynamicScalar[72∈0] ➊"}}:::plan
    __InputDynamicScalar72 --> PgFromExpression75
    Access76{{"Access[76∈0] ➊<br />ᐸ73.itemsᐳ"}}:::plan
    PgSelect73 --> Access76
    First77[["First[77∈0] ➊"]]:::plan
    Access76 --> First77
    PgSelectSingle78{{"PgSelectSingle[78∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First77 --> PgSelectSingle78
    __InputDynamicScalar80{{"__InputDynamicScalar[80∈0] ➊"}}:::plan
    __InputDynamicScalar80 --> PgFromExpression83
    Access84{{"Access[84∈0] ➊<br />ᐸ81.itemsᐳ"}}:::plan
    PgSelect81 --> Access84
    First85[["First[85∈0] ➊"]]:::plan
    Access84 --> First85
    PgSelectSingle86{{"PgSelectSingle[86∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First85 --> PgSelectSingle86
    __InputDynamicScalar88{{"__InputDynamicScalar[88∈0] ➊"}}:::plan
    __InputDynamicScalar88 --> PgFromExpression91
    Access92{{"Access[92∈0] ➊<br />ᐸ89.itemsᐳ"}}:::plan
    PgSelect89 --> Access92
    First93[["First[93∈0] ➊"]]:::plan
    Access92 --> First93
    PgSelectSingle94{{"PgSelectSingle[94∈0] ➊<br />ᐸjsonb_identityᐳ"}}:::plan
    First93 --> PgSelectSingle94
    __InputDynamicScalar96{{"__InputDynamicScalar[96∈0] ➊"}}:::plan
    __InputDynamicScalar96 --> PgFromExpression99
    Access100{{"Access[100∈0] ➊<br />ᐸ97.itemsᐳ"}}:::plan
    PgSelect97 --> Access100
    First101[["First[101∈0] ➊"]]:::plan
    Access100 --> First101
    PgSelectSingle102{{"PgSelectSingle[102∈0] ➊<br />ᐸjsonb_identityᐳ"}}:::plan
    First101 --> PgSelectSingle102
    PgSelect106[["PgSelect[106∈0] ➊<br />ᐸtypesᐳ"]]:::plan
    Object10 --> PgSelect106
    Connection108[["Connection[108∈0] ➊<br />ᐸ106ᐳ"]]:::plan
    PgSelect106 --> Connection108
    ConnectionItems110[["ConnectionItems[110∈0] ➊"]]:::plan
    Connection108 --> ConnectionItems110
    __Item113[/"__Item[113∈3]<br />ᐸ110ᐳ"\]:::itemplan
    ConnectionItems110 ==> __Item113
    PgSelectSingle114{{"PgSelectSingle[114∈3]<br />ᐸtypesᐳ"}}:::plan
    __Item113 --> PgSelectSingle114
    PgClassExpression115{{"PgClassExpression[115∈4]<br />ᐸ__types__.”json”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression115
    PgClassExpression116{{"PgClassExpression[116∈4]<br />ᐸ__types__.”jsonb”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression116

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,PgSelect7,Access8,Access9,Object10,PgFromExpression11,Access12,First13,PgSelectSingle14,PgSelect17,PgFromExpression19,Access20,First21,PgSelectSingle22,PgSelect25,PgFromExpression27,Access28,First29,PgSelectSingle30,PgSelect33,PgFromExpression35,Access36,First37,PgSelectSingle38,PgSelect41,PgFromExpression43,Access44,First45,PgSelectSingle46,__InputDynamicScalar48,PgSelect49,PgFromExpression51,Access52,First53,PgSelectSingle54,__InputDynamicScalar56,PgSelect57,PgFromExpression59,Access60,First61,PgSelectSingle62,__InputDynamicScalar64,PgSelect65,PgFromExpression67,Access68,First69,PgSelectSingle70,__InputDynamicScalar72,PgSelect73,PgFromExpression75,Access76,First77,PgSelectSingle78,__InputDynamicScalar80,PgSelect81,PgFromExpression83,Access84,First85,PgSelectSingle86,__InputDynamicScalar88,PgSelect89,PgFromExpression91,Access92,First93,PgSelectSingle94,__InputDynamicScalar96,PgSelect97,PgFromExpression99,Access100,First101,PgSelectSingle102,PgSelect106,Connection108,ConnectionItems110 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1 bucket1
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item113,PgSelectSingle114 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression115,PgClassExpression116 bucket4

