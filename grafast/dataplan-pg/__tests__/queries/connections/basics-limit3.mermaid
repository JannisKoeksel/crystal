%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/connections/basics-limit3"
    Bucket0("Bucket 0 (root)<br /><br />1: PgSelectInlineApply[52]<br />ᐳ: 10, 11, 56, 57, 12, 15<br />2: PgSelect[9], PgSelect[20]<br />ᐳ: Access[21], Access[32], Access[53]<br />3: Connection[13], First[22]<br />ᐳ: 23, 24<br />4: ConnectionItems[16]<br />5: First[30], Last[34]<br />ᐳ: 31, 33, 35, 36"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 13, 16, 32, 53, 24, 33, 36<br /><br />ROOT Connectionᐸ9ᐳ[13]"):::bucket
    Bucket3("Bucket 3 (listItem)<br />Deps: 32, 53<br /><br />ROOT __Item{3}ᐸ25ᐳ[26]"):::bucket
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 26, 32, 27, 53<br /><br />ROOT Edge{3}[27]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 37, 53<br /><br />ROOT PgSelectSingle{4}ᐸmessagesᐳ[37]<br />1: <br />ᐳ: 41, 54, 55, 47<br />2: First[48]<br />ᐳ: PgSelectSingle[49]"):::bucket
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 49<br /><br />ROOT PgSelectSingle{5}ᐸusersᐳ[49]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6

    %% plan dependencies
    PgSelect9[["PgSelect[9∈0] ➊<br />ᐸmessages+1ᐳ<br />More deps:<br />- Constantᐸ3ᐳ[57]"]]:::plan
    Object12{{"Object[12∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Lambda15{{"Lambda[15∈0] ➊<br />ᐸincludeArchivedConditionᐳ<br />More deps:<br />- Constantᐸ[ undefined, 'INHERIT' ]ᐳ[56]"}}:::plan
    PgSelectInlineApply52["PgSelectInlineApply[52∈0] ➊"]:::plan
    Object12 & Lambda15 & PgSelectInlineApply52 --> PgSelect9
    PgSelect20[["PgSelect[20∈0] ➊<br />ᐸmessages(aggregate)ᐳ<br />More deps:<br />- Constantᐸ3ᐳ[57]"]]:::plan
    Object12 & Lambda15 --> PgSelect20
    Access10{{"Access[10∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access10 & Access11 --> Object12
    Connection13[["Connection[13∈0] ➊<br />ᐸ9ᐳ<br />Dependents: 2<br />More deps:<br />- Constantᐸ3ᐳ[57]"]]:::plan
    PgSelect9 --> Connection13
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access10
    __Value2 --> Access11
    ConnectionItems16[["ConnectionItems[16∈0] ➊<br />Dependents: 3<br />More deps:<br />- Connection[13]"]]:::plan
    Access21{{"Access[21∈0] ➊<br />ᐸ20.itemsᐳ"}}:::plan
    PgSelect20 --> Access21
    First22[["First[22∈0] ➊"]]:::plan
    Access21 --> First22
    PgSelectSingle23{{"PgSelectSingle[23∈0] ➊<br />ᐸmessagesᐳ"}}:::plan
    First22 --> PgSelectSingle23
    First30[["First[30∈0] ➊<br />More deps:<br />- ConnectionItems[16]"]]:::plan
    PgSelectSingle31{{"PgSelectSingle[31∈0] ➊<br />ᐸmessagesᐳ"}}:::plan
    First30 --> PgSelectSingle31
    Access32{{"Access[32∈0] ➊<br />ᐸ9.cursorDetailsᐳ<br />Dependents: 3"}}:::plan
    PgSelect9 --> Access32
    Last34[["Last[34∈0] ➊<br />More deps:<br />- ConnectionItems[16]"]]:::plan
    PgSelectSingle35{{"PgSelectSingle[35∈0] ➊<br />ᐸmessagesᐳ"}}:::plan
    Last34 --> PgSelectSingle35
    Access53{{"Access[53∈0] ➊<br />ᐸ9.m.joinDetailsFor43ᐳ"}}:::plan
    PgSelect9 --> Access53
    PageInfo19{{"PageInfo[19∈1] ➊<br />More deps:<br />- Connection[13]"}}:::plan
    __CloneStream25[["__CloneStream[25∈1] ➊<br />More deps:<br />- ConnectionItems[16]"]]:::plan
    __Item26[/"__Item[26∈3]<br />ᐸ25ᐳ"\]:::itemplan
    __CloneStream25 ==> __Item26
    Edge27{{"Edge[27∈3]"}}:::plan
    __Item26 --> Edge27
    PgCursor39{{"PgCursor[39∈4]<br />More deps:<br />- Access[32]"}}:::plan
    PgSelectSingle37{{"PgSelectSingle[37∈4]<br />ᐸmessagesᐳ"}}:::plan
    PgSelectSingle37 --> PgCursor39
    __Item26 --> PgSelectSingle37
    List54{{"List[54∈5]<br />ᐸ53,37ᐳ"}}:::plan
    Access53 & PgSelectSingle37 --> List54
    PgClassExpression41{{"PgClassExpression[41∈5]<br />ᐸ__messages__.”body”ᐳ"}}:::plan
    PgSelectSingle37 --> PgClassExpression41
    Access47{{"Access[47∈5]<br />ᐸ55.itemsᐳ"}}:::plan
    Lambda55{{"Lambda[55∈5]<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda55 --> Access47
    First48[["First[48∈5]"]]:::plan
    Access47 --> First48
    PgSelectSingle49{{"PgSelectSingle[49∈5]<br />ᐸusersᐳ"}}:::plan
    First48 --> PgSelectSingle49
    List54 --> Lambda55
    PgClassExpression50{{"PgClassExpression[50∈6]<br />ᐸ__users__.”username”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression50
    PgClassExpression51{{"PgClassExpression[51∈6]<br />ᐸ__users__....vatar_url”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression51

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,PgSelect9,Access10,Access11,Object12,Connection13,Lambda15,ConnectionItems16,PgSelect20,Access21,First22,PgSelectSingle23,First30,PgSelectSingle31,Access32,Last34,PgSelectSingle35,PgSelectInlineApply52,Access53 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PageInfo19,__CloneStream25 bucket1
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item26,Edge27 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelectSingle37,PgCursor39 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression41,Access47,First48,PgSelectSingle49,List54,Lambda55 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgClassExpression50,PgClassExpression51 bucket6

