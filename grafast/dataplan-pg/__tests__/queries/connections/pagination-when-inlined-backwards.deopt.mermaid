%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/connections/pagination-when-inlined-backwards"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 10, 11, 83, 86, 87, 12, 14, 30<br />2: PgSelect[9]<br />3: PgSelectRows[15]"):::bucket
    Bucket1("Bucket 1 (listItem)<br />Deps: 12, 83, 30<br /><br />ROOT __Item{1}ᐸ15ᐳ[17]"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 18, 12, 83, 30<br /><br />ROOT PgSelectSingle{1}ᐸforumsᐳ[18]<br />1: <br />ᐳ: 19, 21, 27<br />2: PgSelect[22]<br />3: Connection[26]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 26, 12, 21, 83, 27, 30, 22<br /><br />ROOT Connection{2}ᐸ22ᐳ[26]<br />1: ConnectionItems[31], PgSelect[37]<br />ᐳ: PageInfo[36], Access[52], Access[38]<br />2: 39, 42, 43, 50, 54<br />ᐳ: 40, 41, 51, 53, 55, 56"):::bucket
    Bucket6("Bucket 6 (listItem)<br />Deps: 12<br /><br />ROOT __Item{6}ᐸ42ᐳ[44]"):::bucket
    Bucket7("Bucket 7 (listItem)<br />Deps: 52, 12<br /><br />ROOT __Item{7}ᐸ43ᐳ[46]"):::bucket
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 45, 12<br /><br />ROOT PgSelectSingle{6}ᐸmessagesᐳ[45]<br />1: <br />ᐳ: 57, 61<br />2: PgSelect[62]<br />ᐳ: Access[66]<br />3: First[67]<br />ᐳ: PgSelectSingle[68]"):::bucket
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 46, 52, 47, 12<br /><br />ROOT Edge{7}[47]"):::bucket
    Bucket10("Bucket 10 (nullableBoundary)<br />Deps: 68<br /><br />ROOT PgSelectSingle{8}ᐸusersᐳ[68]"):::bucket
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 58, 12<br /><br />ROOT PgSelectSingle{9}ᐸmessagesᐳ[58]<br />1: <br />ᐳ: 71, 73<br />2: PgSelect[74]<br />ᐳ: Access[78]<br />3: First[79]<br />ᐳ: PgSelectSingle[80]"):::bucket
    Bucket12("Bucket 12 (nullableBoundary)<br />Deps: 80<br /><br />ROOT PgSelectSingle{11}ᐸusersᐳ[80]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket6 & Bucket7
    Bucket6 --> Bucket8
    Bucket7 --> Bucket9
    Bucket8 --> Bucket10
    Bucket9 --> Bucket11
    Bucket11 --> Bucket12

    %% plan dependencies
    PgSelect9[["PgSelect[9∈0] ➊<br />ᐸforumsᐳ<br />More deps:<br />- Object[12]<br />- Constantᐸ2ᐳ[83]"]]:::plan
    Lambda14{{"Lambda[14∈0] ➊<br />ᐸincludeArchivedConditionᐳ<br />More deps:<br />- Constantᐸ[ undefined, 'YES' ]ᐳ[86]"}}:::plan
    Lambda14 --> PgSelect9
    Object12{{"Object[12∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ<br />Dependents: 5"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access10 & Access11 --> Object12
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access10
    __Value2 --> Access11
    PgSelectRows15[["PgSelectRows[15∈0] ➊"]]:::plan
    PgSelect9 --> PgSelectRows15
    Lambda30{{"Lambda[30∈0] ➊<br />ᐸincludeArchivedConditionᐳ<br />Dependents: 2<br />More deps:<br />- Constantᐸ[HIDDEN]ᐳ[87]"}}:::plan
    __Item17[/"__Item[17∈1]<br />ᐸ15ᐳ"\]:::itemplan
    PgSelectRows15 ==> __Item17
    PgSelectSingle18{{"PgSelectSingle[18∈1]<br />ᐸforumsᐳ"}}:::plan
    __Item17 --> PgSelectSingle18
    PgSelect22[["PgSelect[22∈2]<br />ᐸmessages+1ᐳ<br />More deps:<br />- Object[12]<br />- Constantᐸ2ᐳ[83]<br />- Lambda[30]"]]:::plan
    PgClassExpression21{{"PgClassExpression[21∈2]<br />ᐸ__forums__.”id”ᐳ"}}:::plan
    PgClassExpression27{{"PgClassExpression[27∈2]<br />ᐸ__forums__...chived_at”ᐳ"}}:::plan
    PgClassExpression21 & PgClassExpression27 --> PgSelect22
    Connection26[["Connection[26∈2]<br />ᐸ22ᐳ<br />More deps:<br />- Constantᐸ2ᐳ[83]"]]:::plan
    PgSelect22 --> Connection26
    PgClassExpression19{{"PgClassExpression[19∈2]<br />ᐸ__forums__.”name”ᐳ"}}:::plan
    PgSelectSingle18 --> PgClassExpression19
    PgSelectSingle18 --> PgClassExpression21
    PgSelectSingle18 --> PgClassExpression27
    PgSelect37[["PgSelect[37∈3]<br />ᐸmessages(aggregate)ᐳ<br />More deps:<br />- Object[12]<br />- Constantᐸ2ᐳ[83]<br />- Lambda[30]"]]:::plan
    PgClassExpression21 & PgClassExpression27 --> PgSelect37
    PgCursor53{{"PgCursor[53∈3]"}}:::plan
    PgSelectSingle51{{"PgSelectSingle[51∈3]<br />ᐸmessagesᐳ"}}:::plan
    Access52{{"Access[52∈3]<br />ᐸ22.cursorDetailsᐳ"}}:::plan
    PgSelectSingle51 & Access52 --> PgCursor53
    PgCursor56{{"PgCursor[56∈3]"}}:::plan
    PgSelectSingle55{{"PgSelectSingle[55∈3]<br />ᐸmessagesᐳ"}}:::plan
    PgSelectSingle55 & Access52 --> PgCursor56
    ConnectionItems31[["ConnectionItems[31∈3]"]]:::plan
    Connection26 --> ConnectionItems31
    PageInfo36{{"PageInfo[36∈3]"}}:::plan
    Connection26 --> PageInfo36
    Access38{{"Access[38∈3]<br />ᐸ37.itemsᐳ"}}:::plan
    PgSelect37 --> Access38
    First39[["First[39∈3]"]]:::plan
    Access38 --> First39
    PgSelectSingle40{{"PgSelectSingle[40∈3]<br />ᐸmessagesᐳ"}}:::plan
    First39 --> PgSelectSingle40
    PgClassExpression41{{"PgClassExpression[41∈3]<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle40 --> PgClassExpression41
    __CloneStream42[["__CloneStream[42∈3]"]]:::plan
    ConnectionItems31 --> __CloneStream42
    __CloneStream43[["__CloneStream[43∈3]"]]:::plan
    ConnectionItems31 --> __CloneStream43
    First50[["First[50∈3]"]]:::plan
    ConnectionItems31 --> First50
    First50 --> PgSelectSingle51
    PgSelect22 --> Access52
    Last54[["Last[54∈3]"]]:::plan
    ConnectionItems31 --> Last54
    Last54 --> PgSelectSingle55
    __Item44[/"__Item[44∈6]<br />ᐸ42ᐳ"\]:::itemplan
    __CloneStream42 ==> __Item44
    PgSelectSingle45{{"PgSelectSingle[45∈6]<br />ᐸmessagesᐳ"}}:::plan
    __Item44 --> PgSelectSingle45
    __Item46[/"__Item[46∈7]<br />ᐸ43ᐳ"\]:::itemplan
    __CloneStream43 ==> __Item46
    Edge47{{"Edge[47∈7]"}}:::plan
    __Item46 --> Edge47
    PgSelect62[["PgSelect[62∈8]<br />ᐸusersᐳ<br />More deps:<br />- Object[12]"]]:::plan
    PgClassExpression61{{"PgClassExpression[61∈8]<br />ᐸ__messages...author_id”ᐳ"}}:::plan
    PgClassExpression61 --> PgSelect62
    PgClassExpression57{{"PgClassExpression[57∈8]<br />ᐸ__messages__.”body”ᐳ"}}:::plan
    PgSelectSingle45 --> PgClassExpression57
    PgSelectSingle45 --> PgClassExpression61
    Access66{{"Access[66∈8]<br />ᐸ62.itemsᐳ"}}:::plan
    PgSelect62 --> Access66
    First67[["First[67∈8]"]]:::plan
    Access66 --> First67
    PgSelectSingle68{{"PgSelectSingle[68∈8]<br />ᐸusersᐳ"}}:::plan
    First67 --> PgSelectSingle68
    PgCursor60{{"PgCursor[60∈9]"}}:::plan
    PgSelectSingle58{{"PgSelectSingle[58∈9]<br />ᐸmessagesᐳ"}}:::plan
    PgSelectSingle58 & Access52 --> PgCursor60
    __Item46 --> PgSelectSingle58
    PgClassExpression70{{"PgClassExpression[70∈10]<br />ᐸ__users__.”username”ᐳ"}}:::plan
    PgSelectSingle68 --> PgClassExpression70
    PgClassExpression72{{"PgClassExpression[72∈10]<br />ᐸ__users__....vatar_url”ᐳ"}}:::plan
    PgSelectSingle68 --> PgClassExpression72
    PgSelect74[["PgSelect[74∈11]<br />ᐸusersᐳ<br />More deps:<br />- Object[12]"]]:::plan
    PgClassExpression73{{"PgClassExpression[73∈11]<br />ᐸ__messages...author_id”ᐳ"}}:::plan
    PgClassExpression73 --> PgSelect74
    PgClassExpression71{{"PgClassExpression[71∈11]<br />ᐸ__messages__.”body”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression71
    PgSelectSingle58 --> PgClassExpression73
    Access78{{"Access[78∈11]<br />ᐸ74.itemsᐳ"}}:::plan
    PgSelect74 --> Access78
    First79[["First[79∈11]"]]:::plan
    Access78 --> First79
    PgSelectSingle80{{"PgSelectSingle[80∈11]<br />ᐸusersᐳ"}}:::plan
    First79 --> PgSelectSingle80
    PgClassExpression81{{"PgClassExpression[81∈12]<br />ᐸ__users__.”username”ᐳ"}}:::plan
    PgSelectSingle80 --> PgClassExpression81
    PgClassExpression82{{"PgClassExpression[82∈12]<br />ᐸ__users__....vatar_url”ᐳ"}}:::plan
    PgSelectSingle80 --> PgClassExpression82

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,PgSelect9,Access10,Access11,Object12,Lambda14,PgSelectRows15,Lambda30 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item17,PgSelectSingle18 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression19,PgClassExpression21,PgSelect22,Connection26,PgClassExpression27 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,ConnectionItems31,PageInfo36,PgSelect37,Access38,First39,PgSelectSingle40,PgClassExpression41,__CloneStream42,__CloneStream43,First50,PgSelectSingle51,Access52,PgCursor53,Last54,PgSelectSingle55,PgCursor56 bucket3
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item44,PgSelectSingle45 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,__Item46,Edge47 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgClassExpression57,PgClassExpression61,PgSelect62,Access66,First67,PgSelectSingle68 bucket8
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgSelectSingle58,PgCursor60 bucket9
    classDef bucket10 stroke:#ffff00
    class Bucket10,PgClassExpression70,PgClassExpression72 bucket10
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgClassExpression71,PgClassExpression73,PgSelect74,Access78,First79,PgSelectSingle80 bucket11
    classDef bucket12 stroke:#4169e1
    class Bucket12,PgClassExpression81,PgClassExpression82 bucket12

