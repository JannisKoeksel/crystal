%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/functions/computed-column-combined"
    Bucket0("Bucket 0 (root)<br /><br />1: 55, 60<br />ᐳ: 8, 9, 34, 59, 64, 69, 74, 10, 54<br />2: PgSelectInlineApply[65]<br />3: PgSelectInlineApply[70]<br />4: PgSelect[7]<br />ᐳ: Access[11], Access[71]<br />5: First[12]<br />ᐳ: PgSelectSingle[13]"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 71, 13<br /><br />ROOT PgSelectSingleᐸforumsᐳ[13]<br />1: <br />ᐳ: 72, 73, 20, 66<br />2: First[21]<br />ᐳ: PgSelectSingle[22]"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 22, 66<br /><br />ROOT PgSelectSingle{1}ᐸusersᐳ[22]<br />1: <br />ᐳ: 23, 24, 67, 68, 31, 56, 61<br />2: First[32]<br />ᐳ: 33, 62, 63"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 63, 56, 33<br /><br />ROOT PgSelectSingle{2}ᐸusers_most_recent_forumᐳ[33]<br />1: PgSelectRows[49]<br />ᐳ: List[57], Lambda[58], Access[41]<br />2: First[42]<br />ᐳ: 43, 44"):::bucket
    Bucket4("Bucket 4 (listItem)<br /><br />ROOT __Item{4}ᐸ49ᐳ[51]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 52<br /><br />ROOT PgSelectSingle{4}ᐸforums_featured_messagesᐳ[52]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5

    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸforumsᐳ<br />More deps:<br />- Constantᐸ'f1700000-0000-0000-0000-000000000f17'ᐳ[74]"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    PgFromExpression69{{"PgFromExpression[69∈0] ➊"}}:::plan
    PgFromExpression64{{"PgFromExpression[64∈0] ➊"}}:::plan
    PgFromExpression54{{"PgFromExpression[54∈0] ➊<br />More deps:<br />- Constantᐸundefinedᐳ[34]"}}:::plan
    PgFromExpression59{{"PgFromExpression[59∈0] ➊"}}:::plan
    PgSelectInlineApply70["PgSelectInlineApply[70∈0] ➊"]:::plan
    Object10 & PgFromExpression69 & PgFromExpression64 & PgFromExpression54 & PgFromExpression59 & PgSelectInlineApply70 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    PgSelectInlineApply65["PgSelectInlineApply[65∈0] ➊"]:::plan
    PgSelectInlineApply55["PgSelectInlineApply[55∈0] ➊"]:::plan
    PgSelectInlineApply60["PgSelectInlineApply[60∈0] ➊"]:::plan
    PgSelectInlineApply55 & PgSelectInlineApply60 --> PgSelectInlineApply65
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    Access11{{"Access[11∈0] ➊<br />ᐸ7.itemsᐳ"}}:::plan
    PgSelect7 --> Access11
    First12[["First[12∈0] ➊"]]:::plan
    Access11 --> First12
    PgSelectSingle13{{"PgSelectSingle[13∈0] ➊<br />ᐸforumsᐳ"}}:::plan
    First12 --> PgSelectSingle13
    PgSelectInlineApply65 --> PgSelectInlineApply70
    Access71{{"Access[71∈0] ➊<br />ᐸ7.m.joinDetailsFor15ᐳ"}}:::plan
    PgSelect7 --> Access71
    List72{{"List[72∈1] ➊<br />ᐸ71,13ᐳ"}}:::plan
    Access71 & PgSelectSingle13 --> List72
    Access20{{"Access[20∈1] ➊<br />ᐸ73.itemsᐳ"}}:::plan
    Lambda73{{"Lambda[73∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda73 --> Access20
    First21[["First[21∈1] ➊"]]:::plan
    Access20 --> First21
    PgSelectSingle22{{"PgSelectSingle[22∈1] ➊<br />ᐸusersᐳ"}}:::plan
    First21 --> PgSelectSingle22
    Access66{{"Access[66∈1] ➊<br />ᐸ73.m.joinDetailsFor26ᐳ"}}:::plan
    Lambda73 --> Access66
    List72 --> Lambda73
    List62{{"List[62∈2] ➊<br />ᐸ61,32ᐳ"}}:::plan
    Access61{{"Access[61∈2] ➊<br />ᐸ68.m.subqueryDetailsFor46ᐳ"}}:::plan
    First32[["First[32∈2] ➊"]]:::plan
    Access61 & First32 --> List62
    List67{{"List[67∈2] ➊<br />ᐸ66,22ᐳ"}}:::plan
    Access66 & PgSelectSingle22 --> List67
    PgClassExpression23{{"PgClassExpression[23∈2] ➊<br />ᐸ__forums_r...”username”ᐳ"}}:::plan
    PgSelectSingle22 --> PgClassExpression23
    PgClassExpression24{{"PgClassExpression[24∈2] ➊<br />ᐸ__forums_r...vatar_url”ᐳ"}}:::plan
    PgSelectSingle22 --> PgClassExpression24
    Access31{{"Access[31∈2] ➊<br />ᐸ68.itemsᐳ"}}:::plan
    Lambda68{{"Lambda[68∈2] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda68 --> Access31
    Access31 --> First32
    PgSelectSingle33{{"PgSelectSingle[33∈2] ➊<br />ᐸusers_most_recent_forumᐳ"}}:::plan
    First32 --> PgSelectSingle33
    Access56{{"Access[56∈2] ➊<br />ᐸ68.m.joinDetailsFor36ᐳ"}}:::plan
    Lambda68 --> Access56
    Lambda68 --> Access61
    Lambda63{{"Lambda[63∈2] ➊<br />ᐸpgInlineViaSubqueryTransformᐳ"}}:::plan
    List62 --> Lambda63
    List67 --> Lambda68
    List57{{"List[57∈3] ➊<br />ᐸ56,33ᐳ"}}:::plan
    Access56 & PgSelectSingle33 --> List57
    Access41{{"Access[41∈3] ➊<br />ᐸ58.itemsᐳ"}}:::plan
    Lambda58{{"Lambda[58∈3] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda58 --> Access41
    First42[["First[42∈3] ➊"]]:::plan
    Access41 --> First42
    PgSelectSingle43{{"PgSelectSingle[43∈3] ➊<br />ᐸforums_unique_author_countᐳ"}}:::plan
    First42 --> PgSelectSingle43
    PgClassExpression44{{"PgClassExpression[44∈3] ➊<br />ᐸ__forums_u..._count__.vᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression44
    PgSelectRows49[["PgSelectRows[49∈3] ➊"]]:::plan
    Lambda63 --> PgSelectRows49
    List57 --> Lambda58
    __Item51[/"__Item[51∈4]<br />ᐸ49ᐳ"\]:::itemplan
    PgSelectRows49 ==> __Item51
    PgSelectSingle52{{"PgSelectSingle[52∈4]<br />ᐸforums_featured_messagesᐳ"}}:::plan
    __Item51 --> PgSelectSingle52
    PgClassExpression53{{"PgClassExpression[53∈5]<br />ᐸ__forums_f...s__.”body”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression53

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,PgSelect7,Access8,Access9,Object10,Access11,First12,PgSelectSingle13,PgFromExpression54,PgSelectInlineApply55,PgFromExpression59,PgSelectInlineApply60,PgFromExpression64,PgSelectInlineApply65,PgFromExpression69,PgSelectInlineApply70,Access71 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,Access20,First21,PgSelectSingle22,Access66,List72,Lambda73 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression23,PgClassExpression24,Access31,First32,PgSelectSingle33,Access56,Access61,List62,Lambda63,List67,Lambda68 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,Access41,First42,PgSelectSingle43,PgClassExpression44,PgSelectRows49,List57,Lambda58 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item51,PgSelectSingle52 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression53 bucket5

