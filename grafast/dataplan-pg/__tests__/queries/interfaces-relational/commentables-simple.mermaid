%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/interfaces-relational/commentables-simple"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 9, 120, 10<br />2: PgSelect[7]<br />3: PgSelectRows[12]<br />4: __ListTransform[11]"):::bucket
    Bucket1("Bucket 1 (subroutine)<br /><br />ROOT PgSelectSingle{1}ᐸrelational_commentablesᐳ[14]"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 10<br /><br />ROOT __Item{2}ᐸ11ᐳ[16]"):::bucket
    Bucket3("Bucket 3 (polymorphic)<br />__typename: Lambda[22]<br />Deps: 22, 10, 18"):::bucket
    Bucket4("Bucket 4 (polymorphicPartition)<br />|RelationalPost<br />Deps: 10, 18<br />ᐳRelationalPost<br /><br />1: PgSelectInlineApply[108]<br />2: PgSelect[24]<br />ᐳ: Access[28], Access[109]<br />3: First[29]<br />ᐳ: 30, 110, 111, 50<br />4: First[51]<br />ᐳ: 52, 53, 77, 95"):::bucket
    Bucket5("Bucket 5 (polymorphicPartition)<br />|RelationalChecklist<br />Deps: 10, 18<br />ᐳRelationalChecklist<br /><br />1: PgSelectInlineApply[112]<br />2: PgSelect[31]<br />ᐳ: Access[35], Access[113]<br />3: First[36]<br />ᐳ: 37, 114, 115, 59<br />4: First[60]<br />ᐳ: 61, 62, 83, 101"):::bucket
    Bucket6("Bucket 6 (polymorphicPartition)<br />|RelationalChecklistItem<br />Deps: 10, 18<br />ᐳRelationalChecklistItem<br /><br />1: PgSelectInlineApply[116]<br />2: PgSelect[38]<br />ᐳ: Access[42], Access[117]<br />3: First[43]<br />ᐳ: 44, 118, 119, 68<br />4: First[69]<br />ᐳ: 70, 71, 89, 107"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket5 & Bucket6

    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸrelational_commentablesᐳ<br />More deps:<br />- Object[10]<br />- Constantᐸ1ᐳ[120]"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ<br />Dependents: 4"}}:::plan
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    __ListTransform11[["__ListTransform[11∈0] ➊<br />ᐸeach:7ᐳ<br />More deps:<br />- PgSelectRows[12]"]]:::plan
    PgSelectRows12[["PgSelectRows[12∈0] ➊<br />Dependents: 2"]]:::plan
    PgSelect7 --> PgSelectRows12
    __Item13[/"__Item[13∈1]<br />ᐸ12ᐳ<br />More deps:<br />- PgSelectRows[12]"\]:::itemplan
    PgSelectSingle14{{"PgSelectSingle[14∈1]<br />ᐸrelational_commentablesᐳ"}}:::plan
    __Item13 --> PgSelectSingle14
    __Item16[/"__Item[16∈2]<br />ᐸ11ᐳ"\]:::itemplan
    __ListTransform11 ==> __Item16
    PgSelectSingle17{{"PgSelectSingle[17∈2]<br />ᐸrelational_commentablesᐳ"}}:::plan
    __Item16 --> PgSelectSingle17
    PgClassExpression18{{"PgClassExpression[18∈2]<br />ᐸ__relation...les__.”id”ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression18
    PgClassExpression20{{"PgClassExpression[20∈2]<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression20
    Lambda22{{"Lambda[22∈2]<br />ᐸrelationalItemTypeNameFromTypeᐳ"}}:::plan
    PgClassExpression20 -->|rejectNull| Lambda22
    PgSelect24[["PgSelect[24∈4]^<br />ᐸrelational_postsᐳ<br />More deps:<br />- Object[10]"]]:::plan
    PgSelectInlineApply108["PgSelectInlineApply[108∈4] ➊<br />ᐳRelationalPost"]:::plan
    PgClassExpression18 -->|rejectNull| PgSelect24
    PgSelectInlineApply108 --> PgSelect24
    List110{{"List[110∈4]^<br />ᐸ109,30ᐳ"}}:::plan
    Access109{{"Access[109∈4]^<br />ᐸ24.m.joinDetailsFor46ᐳ"}}:::plan
    PgSelectSingle30{{"PgSelectSingle[30∈4]^<br />ᐸrelational_postsᐳ"}}:::plan
    Access109 & PgSelectSingle30 --> List110
    Access28{{"Access[28∈4]^<br />ᐸ24.itemsᐳ"}}:::plan
    PgSelect24 --> Access28
    First29[["First[29∈4]^"]]:::plan
    Access28 --> First29
    First29 --> PgSelectSingle30
    Access50{{"Access[50∈4]^<br />ᐸ111.itemsᐳ"}}:::plan
    Lambda111{{"Lambda[111∈4]^<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda111 --> Access50
    First51[["First[51∈4]^"]]:::plan
    Access50 --> First51
    PgSelectSingle52{{"PgSelectSingle[52∈4]^<br />ᐸrelational_itemsᐳ"}}:::plan
    First51 --> PgSelectSingle52
    PgClassExpression53{{"PgClassExpression[53∈4]^<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression53
    PgClassExpression77{{"PgClassExpression[77∈4]^<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression77
    PgClassExpression95{{"PgClassExpression[95∈4]^<br />ᐸ__relation...”position”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression95
    PgSelect24 --> Access109
    List110 --> Lambda111
    PgSelect31[["PgSelect[31∈5]^<br />ᐸrelational_checklistsᐳ<br />More deps:<br />- Object[10]"]]:::plan
    PgSelectInlineApply112["PgSelectInlineApply[112∈5] ➊<br />ᐳRelationalChecklist"]:::plan
    PgClassExpression18 -->|rejectNull| PgSelect31
    PgSelectInlineApply112 --> PgSelect31
    List114{{"List[114∈5]^<br />ᐸ113,37ᐳ"}}:::plan
    Access113{{"Access[113∈5]^<br />ᐸ31.m.joinDetailsFor55ᐳ"}}:::plan
    PgSelectSingle37{{"PgSelectSingle[37∈5]^<br />ᐸrelational_checklistsᐳ"}}:::plan
    Access113 & PgSelectSingle37 --> List114
    Access35{{"Access[35∈5]^<br />ᐸ31.itemsᐳ"}}:::plan
    PgSelect31 --> Access35
    First36[["First[36∈5]^"]]:::plan
    Access35 --> First36
    First36 --> PgSelectSingle37
    Access59{{"Access[59∈5]^<br />ᐸ115.itemsᐳ"}}:::plan
    Lambda115{{"Lambda[115∈5]^<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda115 --> Access59
    First60[["First[60∈5]^"]]:::plan
    Access59 --> First60
    PgSelectSingle61{{"PgSelectSingle[61∈5]^<br />ᐸrelational_itemsᐳ"}}:::plan
    First60 --> PgSelectSingle61
    PgClassExpression62{{"PgClassExpression[62∈5]^<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression62
    PgClassExpression83{{"PgClassExpression[83∈5]^<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression83
    PgClassExpression101{{"PgClassExpression[101∈5]^<br />ᐸ__relation...”position”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression101
    PgSelect31 --> Access113
    List114 --> Lambda115
    PgSelect38[["PgSelect[38∈6]^<br />ᐸrelational_checklist_itemsᐳ<br />More deps:<br />- Object[10]"]]:::plan
    PgSelectInlineApply116["PgSelectInlineApply[116∈6] ➊<br />ᐳRelationalChecklistItem"]:::plan
    PgClassExpression18 -->|rejectNull| PgSelect38
    PgSelectInlineApply116 --> PgSelect38
    List118{{"List[118∈6]^<br />ᐸ117,44ᐳ"}}:::plan
    Access117{{"Access[117∈6]^<br />ᐸ38.m.joinDetailsFor64ᐳ"}}:::plan
    PgSelectSingle44{{"PgSelectSingle[44∈6]^<br />ᐸrelational_checklist_itemsᐳ"}}:::plan
    Access117 & PgSelectSingle44 --> List118
    Access42{{"Access[42∈6]^<br />ᐸ38.itemsᐳ"}}:::plan
    PgSelect38 --> Access42
    First43[["First[43∈6]^"]]:::plan
    Access42 --> First43
    First43 --> PgSelectSingle44
    Access68{{"Access[68∈6]^<br />ᐸ119.itemsᐳ"}}:::plan
    Lambda119{{"Lambda[119∈6]^<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda119 --> Access68
    First69[["First[69∈6]^"]]:::plan
    Access68 --> First69
    PgSelectSingle70{{"PgSelectSingle[70∈6]^<br />ᐸrelational_itemsᐳ"}}:::plan
    First69 --> PgSelectSingle70
    PgClassExpression71{{"PgClassExpression[71∈6]^<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression71
    PgClassExpression89{{"PgClassExpression[89∈6]^<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression89
    PgClassExpression107{{"PgClassExpression[107∈6]^<br />ᐸ__relation...”position”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression107
    PgSelect38 --> Access117
    List118 --> Lambda119

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,PgSelect7,Access8,Access9,Object10,__ListTransform11,PgSelectRows12 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item13,PgSelectSingle14 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item16,PgSelectSingle17,PgClassExpression18,PgClassExpression20,Lambda22 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect24,Access28,First29,PgSelectSingle30,Access50,First51,PgSelectSingle52,PgClassExpression53,PgClassExpression77,PgClassExpression95,PgSelectInlineApply108,Access109,List110,Lambda111 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgSelect31,Access35,First36,PgSelectSingle37,Access59,First60,PgSelectSingle61,PgClassExpression62,PgClassExpression83,PgClassExpression101,PgSelectInlineApply112,Access113,List114,Lambda115 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgSelect38,Access42,First43,PgSelectSingle44,Access68,First69,PgSelectSingle70,PgClassExpression71,PgClassExpression89,PgClassExpression107,PgSelectInlineApply116,Access117,List118,Lambda119 bucket6

