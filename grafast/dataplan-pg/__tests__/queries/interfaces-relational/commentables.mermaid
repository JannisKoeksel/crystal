%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/interfaces-relational/commentables"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: Access[8], Access[9], Object[10]<br />2: PgSelect[7]<br />3: PgSelectRows[12]<br />4: __ListTransform[11]"):::bucket
    Bucket1("Bucket 1 (subroutine)<br /><br />ROOT PgSelectSingle{1}ᐸrelational_commentablesᐳ[14]"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 10<br /><br />ROOT __Item{2}ᐸ11ᐳ[16]"):::bucket
    Bucket3("Bucket 3 (polymorphic)<br />__typename: Lambda[22]<br />Deps: 22, 10, 18"):::bucket
    Bucket4("Bucket 4 (polymorphicPartition)<br />|RelationalPost<br />Deps: 10, 18<br />ᐳRelationalPost<br /><br />1: PgSelectInlineApply[114]<br />2: PgSelect[24]<br />ᐳ: Access[28], Access[115]<br />3: First[29]<br />ᐳ: 30, 45, 108, 111, 113, 116, 117, 52<br />4: First[53]<br />ᐳ: 54, 55, 77, 95"):::bucket
    Bucket5("Bucket 5 (polymorphicPartition)<br />|RelationalChecklist<br />Deps: 10, 18<br />ᐳRelationalChecklist<br /><br />1: PgSelectInlineApply[118]<br />2: PgSelect[31]<br />ᐳ: Access[35], Access[119]<br />3: First[36]<br />ᐳ: 37, 46, 109, 120, 121, 60<br />4: First[61]<br />ᐳ: 62, 63, 83, 101"):::bucket
    Bucket6("Bucket 6 (polymorphicPartition)<br />|RelationalChecklistItem<br />Deps: 10, 18<br />ᐳRelationalChecklistItem<br /><br />1: PgSelectInlineApply[122]<br />2: PgSelect[38]<br />ᐳ: Access[42], Access[123]<br />3: First[43]<br />ᐳ: 44, 47, 110, 112, 124, 125, 68<br />4: First[69]<br />ᐳ: 70, 71, 89, 107"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket5 & Bucket6

    %% plan dependencies
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ<br />Dependents: 4"}}:::plan
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸrelational_commentablesᐳ<br />More deps:<br />- Object[10]"]]:::plan
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    __ListTransform11[["__ListTransform[11∈0] ➊<br />ᐸeach:7ᐳ<br />More deps:<br />- PgSelectRows[12]"]]:::plan
    PgSelectRows12[["PgSelectRows[12∈0] ➊<br />Dependents: 2"]]:::plan
    PgSelect7 --> PgSelectRows12
    __Item13[/"__Item[13∈1]<br />ᐸ12ᐳ<br />More deps:<br />- PgSelectRows[12]"\]:::itemplan
    PgSelectSingle14{{"PgSelectSingle[14∈1]<br />ᐸrelational_commentablesᐳ"}}:::plan
    __Item13 --> PgSelectSingle14
    __Item16[/"__Item[16∈2]<br />ᐸ11ᐳ"\]:::itemplan
    __ListTransform11 ==> __Item16
    PgSelectSingle17{{"PgSelectSingle[17∈2]<br />ᐸrelational_commentablesᐳ"}}:::plan
    __Item16 --> PgSelectSingle17
    PgClassExpression18{{"PgClassExpression[18∈2]<br />ᐸ__relation...les__.”id”ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression18
    PgClassExpression20{{"PgClassExpression[20∈2]<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression20
    Lambda22{{"Lambda[22∈2]<br />ᐸrelationalItemTypeNameFromTypeᐳ"}}:::plan
    PgClassExpression20 -->|rejectNull| Lambda22
    PgSelect24[["PgSelect[24∈4]^<br />ᐸrelational_postsᐳ<br />More deps:<br />- Object[10]"]]:::plan
    PgSelectInlineApply114["PgSelectInlineApply[114∈4] ➊<br />ᐳRelationalPost"]:::plan
    PgClassExpression18 -->|rejectNull| PgSelect24
    PgSelectInlineApply114 --> PgSelect24
    List116{{"List[116∈4]^<br />ᐸ115,30ᐳ"}}:::plan
    Access115{{"Access[115∈4]^<br />ᐸ24.m.joinDetailsFor48ᐳ"}}:::plan
    PgSelectSingle30{{"PgSelectSingle[30∈4]^<br />ᐸrelational_postsᐳ"}}:::plan
    Access115 & PgSelectSingle30 --> List116
    Access28{{"Access[28∈4]^<br />ᐸ24.itemsᐳ"}}:::plan
    PgSelect24 --> Access28
    First29[["First[29∈4]^"]]:::plan
    Access28 --> First29
    First29 --> PgSelectSingle30
    PgClassExpression45{{"PgClassExpression[45∈4]^<br />ᐸ__relation...sts__.”id”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression45
    Access52{{"Access[52∈4]^<br />ᐸ117.itemsᐳ"}}:::plan
    Lambda117{{"Lambda[117∈4]^<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda117 --> Access52
    First53[["First[53∈4]^"]]:::plan
    Access52 --> First53
    PgSelectSingle54{{"PgSelectSingle[54∈4]^<br />ᐸrelational_itemsᐳ"}}:::plan
    First53 --> PgSelectSingle54
    PgClassExpression55{{"PgClassExpression[55∈4]^<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle54 --> PgClassExpression55
    PgClassExpression77{{"PgClassExpression[77∈4]^<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgSelectSingle54 --> PgClassExpression77
    PgClassExpression95{{"PgClassExpression[95∈4]^<br />ᐸ__relation...”position”ᐳ"}}:::plan
    PgSelectSingle54 --> PgClassExpression95
    PgClassExpression108{{"PgClassExpression[108∈4]^<br />ᐸ__relation...__.”title”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression108
    PgClassExpression111{{"PgClassExpression[111∈4]^<br />ᐸ__relation...scription”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression111
    PgClassExpression113{{"PgClassExpression[113∈4]^<br />ᐸ__relation...s__.”note”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression113
    PgSelect24 --> Access115
    List116 --> Lambda117
    PgSelect31[["PgSelect[31∈5]^<br />ᐸrelational_checklistsᐳ<br />More deps:<br />- Object[10]"]]:::plan
    PgSelectInlineApply118["PgSelectInlineApply[118∈5] ➊<br />ᐳRelationalChecklist"]:::plan
    PgClassExpression18 -->|rejectNull| PgSelect31
    PgSelectInlineApply118 --> PgSelect31
    List120{{"List[120∈5]^<br />ᐸ119,37ᐳ"}}:::plan
    Access119{{"Access[119∈5]^<br />ᐸ31.m.joinDetailsFor56ᐳ"}}:::plan
    PgSelectSingle37{{"PgSelectSingle[37∈5]^<br />ᐸrelational_checklistsᐳ"}}:::plan
    Access119 & PgSelectSingle37 --> List120
    Access35{{"Access[35∈5]^<br />ᐸ31.itemsᐳ"}}:::plan
    PgSelect31 --> Access35
    First36[["First[36∈5]^"]]:::plan
    Access35 --> First36
    First36 --> PgSelectSingle37
    PgClassExpression46{{"PgClassExpression[46∈5]^<br />ᐸ__relation...sts__.”id”ᐳ"}}:::plan
    PgSelectSingle37 --> PgClassExpression46
    Access60{{"Access[60∈5]^<br />ᐸ121.itemsᐳ"}}:::plan
    Lambda121{{"Lambda[121∈5]^<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda121 --> Access60
    First61[["First[61∈5]^"]]:::plan
    Access60 --> First61
    PgSelectSingle62{{"PgSelectSingle[62∈5]^<br />ᐸrelational_itemsᐳ"}}:::plan
    First61 --> PgSelectSingle62
    PgClassExpression63{{"PgClassExpression[63∈5]^<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle62 --> PgClassExpression63
    PgClassExpression83{{"PgClassExpression[83∈5]^<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgSelectSingle62 --> PgClassExpression83
    PgClassExpression101{{"PgClassExpression[101∈5]^<br />ᐸ__relation...”position”ᐳ"}}:::plan
    PgSelectSingle62 --> PgClassExpression101
    PgClassExpression109{{"PgClassExpression[109∈5]^<br />ᐸ__relation...__.”title”ᐳ"}}:::plan
    PgSelectSingle37 --> PgClassExpression109
    PgSelect31 --> Access119
    List120 --> Lambda121
    PgSelect38[["PgSelect[38∈6]^<br />ᐸrelational_checklist_itemsᐳ<br />More deps:<br />- Object[10]"]]:::plan
    PgSelectInlineApply122["PgSelectInlineApply[122∈6] ➊<br />ᐳRelationalChecklistItem"]:::plan
    PgClassExpression18 -->|rejectNull| PgSelect38
    PgSelectInlineApply122 --> PgSelect38
    List124{{"List[124∈6]^<br />ᐸ123,44ᐳ"}}:::plan
    Access123{{"Access[123∈6]^<br />ᐸ38.m.joinDetailsFor64ᐳ"}}:::plan
    PgSelectSingle44{{"PgSelectSingle[44∈6]^<br />ᐸrelational_checklist_itemsᐳ"}}:::plan
    Access123 & PgSelectSingle44 --> List124
    Access42{{"Access[42∈6]^<br />ᐸ38.itemsᐳ"}}:::plan
    PgSelect38 --> Access42
    First43[["First[43∈6]^"]]:::plan
    Access42 --> First43
    First43 --> PgSelectSingle44
    PgClassExpression47{{"PgClassExpression[47∈6]^<br />ᐸ__relation...ems__.”id”ᐳ"}}:::plan
    PgSelectSingle44 --> PgClassExpression47
    Access68{{"Access[68∈6]^<br />ᐸ125.itemsᐳ"}}:::plan
    Lambda125{{"Lambda[125∈6]^<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda125 --> Access68
    First69[["First[69∈6]^"]]:::plan
    Access68 --> First69
    PgSelectSingle70{{"PgSelectSingle[70∈6]^<br />ᐸrelational_itemsᐳ"}}:::plan
    First69 --> PgSelectSingle70
    PgClassExpression71{{"PgClassExpression[71∈6]^<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression71
    PgClassExpression89{{"PgClassExpression[89∈6]^<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression89
    PgClassExpression107{{"PgClassExpression[107∈6]^<br />ᐸ__relation...”position”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression107
    PgClassExpression110{{"PgClassExpression[110∈6]^<br />ᐸ__relation...scription”ᐳ"}}:::plan
    PgSelectSingle44 --> PgClassExpression110
    PgClassExpression112{{"PgClassExpression[112∈6]^<br />ᐸ__relation...s__.”note”ᐳ"}}:::plan
    PgSelectSingle44 --> PgClassExpression112
    PgSelect38 --> Access123
    List124 --> Lambda125

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,PgSelect7,Access8,Access9,Object10,__ListTransform11,PgSelectRows12 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item13,PgSelectSingle14 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item16,PgSelectSingle17,PgClassExpression18,PgClassExpression20,Lambda22 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect24,Access28,First29,PgSelectSingle30,PgClassExpression45,Access52,First53,PgSelectSingle54,PgClassExpression55,PgClassExpression77,PgClassExpression95,PgClassExpression108,PgClassExpression111,PgClassExpression113,PgSelectInlineApply114,Access115,List116,Lambda117 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgSelect31,Access35,First36,PgSelectSingle37,PgClassExpression46,Access60,First61,PgSelectSingle62,PgClassExpression63,PgClassExpression83,PgClassExpression101,PgClassExpression109,PgSelectInlineApply118,Access119,List120,Lambda121 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgSelect38,Access42,First43,PgSelectSingle44,PgClassExpression47,Access68,First69,PgSelectSingle70,PgClassExpression71,PgClassExpression89,PgClassExpression107,PgClassExpression110,PgClassExpression112,PgSelectInlineApply122,Access123,List124,Lambda125 bucket6

